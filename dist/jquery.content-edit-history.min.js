/*
 *  Content Edit - v0.1.2
 *  HTML Content Edit (jQuery) plugin. To edit content with a more complex workflow than just an inline editable.
 *  https://github.com/oncletom/content-edit
 *
 *  Made by Thomas Parisot
 *  Under Apache-2.0 License
 */
!function(a){"use strict";function b(a){this.editable=a,this.historyElement=null,this.init(a)}b.namespace="history",b.prototype.init=function(b){this.historyElement=this.resolveHistoryElement(b),a(this.historyElement).data("editable-source",b)},b.prototype.resolveHistoryElement=function(c){for(var d,e=a(c.templateElement),f=c.selector(b.namespace),g=[function(a){return e.siblings(a)},function(b){return a(b)}];!d&&g.length;)d=g.shift()(f).get(0);return d},b.prototype.idle=function(){a(this.historyElement).addClass(this.editable.options.visibilityTogglingClass),a(this.historyElement).data("editable-source",null)},b.prototype.editing=function(){a(this.historyElement).data("editable-source",this.editable),a(this.historyElement).removeClass(this.editable.options.visibilityTogglingClass)},b.prototype.revertRevision=function(a){this.copyRevision(a),this.editable.setState("saving")},b.prototype.copyRevision=function(b){var c={};a(b).find("[data-editable-history-revision]").each(function(b,d){c[d.getAttribute("data-editable-history-revision")]=a(d).html()}),this.editable.constructor.setContents(c,a(this.editable.templateElement),!0,this.editable),this.editable.setState("editing")},b.UIStateHandler=function(a,c){var d=c.plugins[b.namespace];d||(d=c.plugins[b.namespace]=new b(c)),(a.namespace===c.state||"any"===a.namespace)&&d.historyElement&&d[c.state]&&d[c.state](a)},b.processRevisionAction=function(){var c=b.namespace,d=a(this).parents("[data-editable-"+c+"]").data("editable-source"),e=this.getAttribute("data-editable-"+c+"-action")+"Revision",f=d.plugins[c];f.historyElement&&f[e]&&f[e](a(this).parents(".editable-history-item").get(0))},b.dispatch=function(a){a.on("editable.construct editable.any","[data-editable]",b.UIStateHandler),a.on("click","a[data-editable-history-action]",b.processRevisionAction)},a.fn.editable.historyPluginConstructor=b,b.dispatch(a(document))}(jQuery,document,window);